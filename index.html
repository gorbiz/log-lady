<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2285%22>ü™µ</text></svg>">
  <title>LogLady 1.0</title>

  <style>
    ul.logs { list-style: none; padding: 0; }
    ul.logs li { margin-bottom: 4px; }
    ul.logs li a.remove { font-size: 12px; opacity: 0.5; text-decoration: underline; cursor: pointer; }
    ul.logs .date { opacity: 0.66; font-size: 12px; }
  </style>
</head>

<body>
  <form id="logForm">
    <input type="text" id="text" name="text" placeholder="log here...">
  </form>
  <ul class="logs"></ul>
  <button id="remove-all">‚ùå Remove all</button>

  <script type="module">
    import { LogLady } from './loglady.js'
    const logLady = new LogLady()

    function submitLog (event) {
      event.preventDefault()
      const input = document.querySelector('input#text')
      logLady.add({ text: input.value.trim() })
      input.value = ''
    }

    // TODO consider custom event 
    logLady.on('logAdded logRemoved logsCleared', () =>  renderLogs())

    function renderLogs () {
      const logs = logLady.get() // NOTE instead of this we could usually change the DOM for the new / modified log
      const logToHTML = log => {
        const date = log.created.replace('T', ' ').split('.')[0]
        return `${log.text} <a class="remove">remove</a>
          <div class="date">${date}</div>`
      }
      const el = document.querySelector('ul.logs')
      el.innerHTML = logs.map(log => `<li id="log-${log.id}">${logToHTML(log)}</li>`).join('')
      // add onclick to the remove links
      logs.forEach(({ id }) => {
        const el = document.getElementById(`log-${id}`)
        el.querySelector('a.remove').addEventListener('click', () => logLady.remove(id))
      })
    }

    document.getElementById('logForm').addEventListener('submit', submitLog)
    document.getElementById('remove-all').addEventListener('click', () => {
      if (confirm('Sure?')) logLady.clear()
    })

    renderLogs()
  </script>
</body>
</html>